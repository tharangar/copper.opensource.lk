



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Copper email solution documentation">
      
      
        <link rel="canonical" href="https://copper.opensource.lk/troubleshoot/">
      
      
        <meta name="author" content="Lanka Software Foundation">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.2">
    
    
      
        <title>Troubleshoot - Copper mail</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.3020aac5.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#ffa000">
      
    
    
      <script src="../assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="amber" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#troubleshoot" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://copper.opensource.lk" title="Copper mail" class="md-header-nav__button md-logo">
          
            <img src="../images/copper_logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Copper mail
            </span>
            <span class="md-header-nav__topic">
              Troubleshoot
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/LSFLK/Copper/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LSFLK/Copper
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://copper.opensource.lk" title="Copper mail" class="md-nav__button md-logo">
      
        <img src="../images/copper_logo.svg" width="48" height="48">
      
    </a>
    Copper mail
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/LSFLK/Copper/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    LSFLK/Copper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../Overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Prerequisites/" title="Prerequisites" class="md-nav__link">
      Prerequisites
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Installation/" title="Installation" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Configuration/" title="Initial Configuration" class="md-nav__link">
      Initial Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CConfiguration/" title="Client Configuration" class="md-nav__link">
      Client Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../userfeature/" title="Groupware Features" class="md-nav__link">
      Groupware Features
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Backups/" title="Backup & Restoration" class="md-nav__link">
      Backup & Restoration
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Troubleshoot
      </label>
    
    <a href="./" title="Troubleshoot" class="md-nav__link md-nav__link--active">
      Troubleshoot
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-postfix" title="Testing Postfix" class="md-nav__link">
    Testing Postfix
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabledisable-plaintext-authentication-for-smtp" title="Enable/Disable plaintext Authentication for SMTP" class="md-nav__link">
    Enable/Disable plaintext Authentication for SMTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-mail-sending-with-port-25-plaintext-authenticaiton" title="Test mail sending with port 25 (plaintext authenticaiton)" class="md-nav__link">
    Test mail sending with port 25 (plaintext authenticaiton)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-send-mail-with-tls-587-port" title="Test send mail with TLS (587 port)" class="md-nav__link">
    Test send mail with TLS (587 port)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-check-the-submission-port" title="Step 2 Check the submission port." class="md-nav__link">
    Step 2 Check the submission port.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-check-the-postfix-log-file" title="Step 3 Check the postfix log file" class="md-nav__link">
    Step 3 Check the postfix log file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-check-the-dovecot-log-file" title="Step 4 check the dovecot log file" class="md-nav__link">
    Step 4 check the dovecot log file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5" title="Step 5" class="md-nav__link">
    Step 5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5_1" title="Step 5" class="md-nav__link">
    Step 5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-submission-port" title="check the submission port" class="md-nav__link">
    check the submission port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-related-issues-and-solutions" title="Email related issues and solutions." class="md-nav__link">
    Email related issues and solutions.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-dovecot" title="Testing dovecot" class="md-nav__link">
    Testing dovecot
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disableenable-plaintext-unencripted-authentication-for-dovecot" title="Disable/Enable plaintext unencripted authentication for DOVECOT" class="md-nav__link">
    Disable/Enable plaintext unencripted authentication for DOVECOT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-user-validaiton-with-dovecot-imap-server" title="Check user validaiton with dovecot imap server" class="md-nav__link">
    Check user validaiton with dovecot imap server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-imap-server-dovecot-with-telnet" title="Test imap server (dovecot) with telnet" class="md-nav__link">
    Test imap server (dovecot) with telnet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-openldap-server" title="Testing openldap server" class="md-nav__link">
    Testing openldap server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-ldap-server-connectivity" title="Testing ldap server connectivity." class="md-nav__link">
    Testing ldap server connectivity.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-ldif-file-for-changingupdating-the-openldap-server" title="Use ldif file for changing/updating the openldap server" class="md-nav__link">
    Use ldif file for changing/updating the openldap server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-openldap-server" title="Test the openLDAP server" class="md-nav__link">
    Test the openLDAP server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-tls-ldap-testing" title="Advanced TLS - ldap testing" class="md-nav__link">
    Advanced TLS - ldap testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-testing" title="Database Testing" class="md-nav__link">
    Database Testing
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Hub/" title="Central Supervision" class="md-nav__link">
      Central Supervision
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../issues/" title="Email security" class="md-nav__link">
      Email security
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#testing-postfix" title="Testing Postfix" class="md-nav__link">
    Testing Postfix
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabledisable-plaintext-authentication-for-smtp" title="Enable/Disable plaintext Authentication for SMTP" class="md-nav__link">
    Enable/Disable plaintext Authentication for SMTP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-mail-sending-with-port-25-plaintext-authenticaiton" title="Test mail sending with port 25 (plaintext authenticaiton)" class="md-nav__link">
    Test mail sending with port 25 (plaintext authenticaiton)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-send-mail-with-tls-587-port" title="Test send mail with TLS (587 port)" class="md-nav__link">
    Test send mail with TLS (587 port)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-check-the-submission-port" title="Step 2 Check the submission port." class="md-nav__link">
    Step 2 Check the submission port.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-check-the-postfix-log-file" title="Step 3 Check the postfix log file" class="md-nav__link">
    Step 3 Check the postfix log file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-check-the-dovecot-log-file" title="Step 4 check the dovecot log file" class="md-nav__link">
    Step 4 check the dovecot log file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5" title="Step 5" class="md-nav__link">
    Step 5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5_1" title="Step 5" class="md-nav__link">
    Step 5
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-the-submission-port" title="check the submission port" class="md-nav__link">
    check the submission port
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#email-related-issues-and-solutions" title="Email related issues and solutions." class="md-nav__link">
    Email related issues and solutions.
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-dovecot" title="Testing dovecot" class="md-nav__link">
    Testing dovecot
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disableenable-plaintext-unencripted-authentication-for-dovecot" title="Disable/Enable plaintext unencripted authentication for DOVECOT" class="md-nav__link">
    Disable/Enable plaintext unencripted authentication for DOVECOT
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#check-user-validaiton-with-dovecot-imap-server" title="Check user validaiton with dovecot imap server" class="md-nav__link">
    Check user validaiton with dovecot imap server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-imap-server-dovecot-with-telnet" title="Test imap server (dovecot) with telnet" class="md-nav__link">
    Test imap server (dovecot) with telnet
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-openldap-server" title="Testing openldap server" class="md-nav__link">
    Testing openldap server
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#testing-ldap-server-connectivity" title="Testing ldap server connectivity." class="md-nav__link">
    Testing ldap server connectivity.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-ldif-file-for-changingupdating-the-openldap-server" title="Use ldif file for changing/updating the openldap server" class="md-nav__link">
    Use ldif file for changing/updating the openldap server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-the-openldap-server" title="Test the openLDAP server" class="md-nav__link">
    Test the openLDAP server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-tls-ldap-testing" title="Advanced TLS - ldap testing" class="md-nav__link">
    Advanced TLS - ldap testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-testing" title="Database Testing" class="md-nav__link">
    Database Testing
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/LSFLK/Copper/edit/master/docs/troubleshoot.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="troubleshoot">Troubleshoot<a class="headerlink" href="#troubleshoot" title="Permanent link">&para;</a></h1>
<p align="justify">
Troubleshooting and debugging is very imporatn in any complex IT solution. Hear in copper there are few critical points which is requied special attention in any case of technical issue. Basically copper solution consists with 5 major components . Email server, Openldap server, Group Office web client, Phpldapadmin and mysql databae. But Trouble shooting is mostly requied for emailserver and openldap server.
So it is requied to know the trouble shooting points of these two containers.
</p>

<h2 id="testing-postfix">Testing Postfix<a class="headerlink" href="#testing-postfix" title="Permanent link">&para;</a></h2>
<p>Check the service is running</p>
<div class="codehilite"><pre><span></span>service postfix status
</pre></div>


<p>Check the configuration</p>
<div class="codehilite"><pre><span></span>postconf -n
</pre></div>


<p>Check the log</p>
<div class="codehilite"><pre><span></span>more /var/log/mail.log

more /var/log/mail.err
</pre></div>


<p>Change postfix configuration file and reload the configuration.</p>
<div class="codehilite"><pre><span></span>postfix reload
postfix/postfix-script: refreshing the Postfix mail system
</pre></div>


<h3 id="enabledisable-plaintext-authentication-for-smtp">Enable/Disable plaintext Authentication for SMTP<a class="headerlink" href="#enabledisable-plaintext-authentication-for-smtp" title="Permanent link">&para;</a></h3>
<p>Please comment out lines below in Postfix config file /etc/postfix/main.cf and reload or restart Postfix service:</p>
<div class="codehilite"><pre><span></span>smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous
</pre></div>


<p>force all clients to use secure connection through port 25
    smtpd_tls_auth_only=yes</p>
<h3 id="test-mail-sending-with-port-25-plaintext-authenticaiton">Test mail sending with port 25 (plaintext authenticaiton)<a class="headerlink" href="#test-mail-sending-with-port-25-plaintext-authenticaiton" title="Permanent link">&para;</a></h3>
<p>Suppose your emailserver is in the localhost</p>
<div class="codehilite"><pre><span></span>wso2s-MacBook-Pro:docker wso2$ telnet localhost 25
Trying ::1…
telnet: connect to address ::1: Connection refused
Trying 127.0.0.1…
Connected to localhost.
Escape character is ‘^]’.
220 mail.lsf.cu.lk ESMTP Postfix (Ubuntu)
EHLO localhost
250-mail.lsf.cu.lk
250-PIPELINING
250-SIZE 10240000
250-VRFY
250-ETRN
250-STARTTLS
250-ENHANCEDSTATUSCODES
250–8BITMIME
250-DSN
250 SMTPUTF8
MAIL FROM:info@lsf.cu.lk
250 2.1.0 Ok
data
554 5.5.1 Error: no valid recipients
subject:hello
221 2.7.0 Error: I can break rules, too. Goodbye.
Connection closed by foreign host.
wso2s-MacBook-Pro:docker wso2$ telnet localhost 25
Trying ::1…
telnet: connect to address ::1: Connection refused
Trying 127.0.0.1…
Connected to localhost.
Escape character is ‘^]’.
220 mail.lsf.cu.lk ESMTP Postfix (Ubuntu)
MAIL FROM:dadmin@lsf.cu.lk
250 2.1.0 Ok
RCPT TO:info@lsf.cu.lk
250 2.1.5 Ok
data
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
subject:hello
body:hello
.
250 2.0.0 Ok: queued as DBE312003D5
421 4.4.2 mail.lsf.cu.lk Error: timeout exceeded
Connection closed by foreign host.
wso2s-MacBook-Pro:docker wso2$
</pre></div>


<h3 id="test-send-mail-with-tls-587-port">Test send mail with TLS (587 port)<a class="headerlink" href="#test-send-mail-with-tls-587-port" title="Permanent link">&para;</a></h3>
<p>Even though it is possible to send messages using port 25 configuration, it is not possible to send email with TLS activated port 587.
Then you have to check email server connection with TLS. You should have installed openssl tool.</p>
<div class="codehilite"><pre><span></span>root@email-b6c7d4c7f-5t87l:/var/log# openssl s_client -connect email:587 -starttls smtp
CONNECTED(00000003)
depth=0 C = US, ST = Oregon, L = Portland, O = lsf, OU = Org, CN = mail.copper.test.lk
verify error:num=18:self signed certificate
verify return:1
depth=0 C = US, ST = Oregon, L = Portland, O = lsf, OU = Org, CN = mail.copper.test.lk
verify return:1
---
Certificate chain
 0 s:/C=US/ST=Oregon/L=Portland/O=lsf/OU=Org/CN=mail.copper.test.lk
   i:/C=US/ST=Oregon/L=Portland/O=lsf/OU=Org/CN=mail.copper.test.lk
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIFrDCCA5SgAwIBAgIJAN+f6wFnoARaMA0GCSqGSIb3DQEBCwUAMGsxCzAJBgNV
1kcNTDFiDeY0F8m/L4C9wUyYA5Ebi5tJGc/Gz4AcAFcgF1Kxt9I3//rQl8Kp0X6D
djw8jiiXJMI82MGgUvJqYvYzAXwYin7aed+7PDkbC7hljlnJXEsnAMBROvQ++zHX
1dAf5AxeMj+YDFm6kiX/lg==
-----END CERTIFICATE-----
subject=/C=US/ST=Oregon/L=Portland/O=lsf/OU=Org/CN=mail.copper.test.lk
issuer=/C=US/ST=Oregon/L=Portland/O=lsf/OU=Org/CN=mail.copper.test.lk
---
No client certificate CA names sent
Peer signing digest: SHA512
Server Temp Key: X25519, 253 bits
---
SSL handshake has read 2559 bytes and written 302 bytes
Verification error: self signed certificate
---
New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384
Server public key is 4096 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-RSA-AES256-GCM-SHA384
    Session-ID: 971757A8240C0495552B360CCFACF8A2FBF00411A5B30605100F19E54D1722E9
    Session-ID-ctx: 
    Master-Key: 9380516DC2C86E8E67EABDB62A256DBEE2290A24D515646008C854DB737BB2AEA3C62E35AC6C484EB5A71814B1ED8AC4
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    TLS session ticket lifetime hint: 7200 (seconds)
    TLS session ticket:
    0000 - 5e 8b 3a 7a 5f 7f 2f 21-9a 8c e4 44 0f 08 28 dd   ^.:z_./!...D..(.
    0010 - bb fe 97 6d b8 04 2f 6c-4e 4a d9 86 b5 34 8e ee   ...m../lNJ...4..
    0020 - 86 df f3 f8 b4 98 9d 67-62 00 54 94 59 57 ad 48   .......gb.T.YW.H
    0030 - 58 50 d8 66 72 c3 04 e7-cb 8e 74 0a db da e6 9b   XP.fr.....t.....
    0040 - 06 d6 d3 db f2 6e f0 32-e0 a0 18 a0 d4 db d6 f1   .....n.2........
    0050 - 4d 97 fc 51 03 2e bb 20-1e 52 4e c6 41 34 38 32   M..Q... .RN.A482
    0060 - fb d9 7a 8d 01 af a5 45-5c 69 9a 93 87 fc af 27   ..z....E\i.....&#39;
    0070 - e1 97 0b 77 f1 04 dd 15-65 15 3a 0a d3 dd bb 3c   ...w....e.:....&lt;
    0080 - 5f de a4 23 4b 3e 4b 2a-d0 41 12 f4 04 83 7c 3b   _..#K&gt;K*.A....|;
    0090 - a0 51 11 2b 71 69 a5 d1-f8 b6 26 51 2e fe 2b 1c   .Q.+qi....&amp;Q..+.
    00a0 - 84 e9 6c 74 59 4c 46 11-a5 a9 fe c0 f1 b4 b2 46   ..ltYLF........F

    Start Time: 1553159047
    Timeout   : 7200 (sec)
    Verify return code: 18 (self signed certificate)
    Extended master secret: yes
---
250 SMTPUTF8
mail from:test@copper.test.lk
250 2.1.0 Ok
rcpt to:test@copper.test.lk
554 5.7.1 &lt;unknown[10.1.0.1]&gt;: Client host rejected: Access denied
quit
221 2.0.0 Bye
closed
root@email-b6c7d4c7f-5t87l:/var/log# 
</pre></div>


<h3 id="step-2-check-the-submission-port">Step 2 Check the submission port.<a class="headerlink" href="#step-2-check-the-submission-port" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>grep submission /etc/services
</pre></div>


<h3 id="step-3-check-the-postfix-log-file">Step 3 Check the postfix log file<a class="headerlink" href="#step-3-check-the-postfix-log-file" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>Mar 21 08:47:22 email-b6c7d4c7f-5t87l postfix/submission/smtpd[395]: connect from unknown[10.1.7.188]
Mar 21 08:47:22 email-b6c7d4c7f-5t87l postfix/submission/smtpd[395]: NOQUEUE: reject: RCPT from unknown[10.1.7.188]: 554 5.7.1 &lt;unknown[10.1.7.188]&gt;: Client host rejected: Access denied; from=&lt;test@copper.test.lk&gt; to=&lt;test@copper.test.lk&gt; proto=ESMTP helo=&lt;localhost&gt;
Mar 21 08:47:22 email-b6c7d4c7f-5t87l postfix/submission/smtpd[395]: disconnect from unknown[10.1.7.188] ehlo=2 starttls=1 mail=1 rcpt=0/1 data=0/1 quit=1 commands=5/7
Mar 21 08:50:42 email-b6c7d4c7f-5t87l postfix/anvil[398]: statistics: max connection rate 1/60s for (submission:10.1.7.188) at Mar 21 08:47:22
Mar 21 08:50:42 email-b6c7d4c7f-5t87l postfix/anvil[398]: statistics: max connection count 1 for (submission:10.1.7.188) at Mar 21 08:47:22
Mar 21 08:50:42 email-b6c7d4c7f-5t87l postfix/anvil[398]: statistics: max cache size 1 at Mar 21 08:47:22
</pre></div>


<h3 id="step-4-check-the-dovecot-log-file">Step 4 check the dovecot log file<a class="headerlink" href="#step-4-check-the-dovecot-log-file" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>Mar 21 08:48:28 imap-login: Info: Login: user=&lt;test&gt;, method=PLAIN, rip=10.1.7.188, lip=10.1.7.185, mpid=404, TLS, session=&lt;pX9RzZaECtYKAQe8&gt;
Mar 21 08:48:28 imap(test): Info: Logged out in=54 out=768
Mar 21 08:50:02 auth: Error: ldap_unbind
Mar 21 08:50:02 auth: Error: ldap_free_connection 1 1
Mar 21 08:50:02 auth: Error: ldap_send_unbind
Mar 21 08:50:02 auth: Error: ldap_free_connection: actually freed
</pre></div>


<h3 id="step-5">Step 5<a class="headerlink" href="#step-5" title="Permanent link">&para;</a></h3>
<p>According to observation looks like postfix has rejected client requests when comes from the port 587.
Then checked the submission has enabled in master.cf file. It should have following configuration.</p>
<div class="codehilite"><pre><span></span>submission inet n       -       n       -       -       smtpd
  -o syslog_name=postfix/submission
  -o smtpd_tls_security_level=encrypt
  -o smtpd_sasl_auth_enable=yes
  -o smtpd_client_restrictions=permit_sasl_authenticated,reject
  -o milter_macro_daemon_name=ORIGINATING
</pre></div>


<h3 id="step-5_1">Step 5<a class="headerlink" href="#step-5_1" title="Permanent link">&para;</a></h3>
<p>Now checked mail sending with port number 25.</p>
<div class="codehilite"><pre><span></span>openssl s_client -connect email:25 -starttls smtp

    0090 - a1 d2 a7 4d e8 ed 1f 79-b7 8c ba a9 a3 0f 7a 2c   ...M...y......z,
    00a0 - 67 2b af f8 44 fc 61 c2-7f a9 7f 79 af fa e7      g+..D.a....y...
    00b0 - &lt;SPACES/NULS&gt;

    Start Time: 1553160437
    Timeout   : 7200 (sec)
    Verify return code: 18 (self signed certificate)
    Extended master secret: yes
---
250 SMTPUTF8
mail from:test@copper.test.lk
250 2.1.0 Ok
rcpt to:test@copper.test.lk
250 2.1.5 Ok
data
354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
subject:Test from 25
body:test form 25
.
250 2.0.0 Ok: queued as A8C1C3812E0
</pre></div>


<p>It was also success. Then it is clear issue comes only when sending mail using port number 587.</p>
<h3 id="check-the-submission-port">check the submission port<a class="headerlink" href="#check-the-submission-port" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>grep submission /etc/services
</pre></div>


<h3 id="email-related-issues-and-solutions">Email related issues and solutions.<a class="headerlink" href="#email-related-issues-and-solutions" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>https://support.plesk.com/hc/en-us/sections/115000422433-Mail
</pre></div>


<hr />
<h2 id="testing-dovecot">Testing dovecot<a class="headerlink" href="#testing-dovecot" title="Permanent link">&para;</a></h2>
<p>check dovecot version</p>
<div class="codehilite"><pre><span></span>dovecot — version
2.2.22 (fe789d2)
</pre></div>


<p>check the active configuration</p>
<div class="codehilite"><pre><span></span>doveconf -n
</pre></div>


<p>Check dovecot log files</p>
<div class="codehilite"><pre><span></span>more /var/log/dovecot.log
</pre></div>


<p>Check dovecot service is running</p>
<div class="codehilite"><pre><span></span>service dovecot status
</pre></div>


<h3 id="disableenable-plaintext-unencripted-authentication-for-dovecot">Disable/Enable plaintext unencripted authentication for DOVECOT<a class="headerlink" href="#disableenable-plaintext-unencripted-authentication-for-dovecot" title="Permanent link">&para;</a></h3>
<p>If you want to enable POP3/IMAP services without STARTTLS for some reason (again, not recommended), please update below two parameters in Dovecot config file /etc/dovecot/dovecot.conf and restart Dovecot service:</p>
<div class="codehilite"><pre><span></span>on Linux and OpenBSD, it’s /etc/dovecot/dovecot.conf
on FreeBSD, it’s /usr/local/etc/dovecot/dovecot.conf

disable_plaintext_auth=no
ssl=yes
</pre></div>


<p>Again, it’s strongly recommended to use only POP3S/IMAPS for better security.</p>
<div class="codehilite"><pre><span></span>disable_plaintext_auth=yes
ssl=required
</pre></div>


<p>Test by telnet</p>
<div class="codehilite"><pre><span></span>Telnet &lt;IP address of Client Access Server (Exchange)&gt; &lt;Port # 143&gt;.
</pre></div>


<p>if connection not established</p>
<ol>
<li>check ports</li>
<li>check 10-main.conf file whether 143 open for imap</li>
<li>check dovcot.conf wether listn ipv4</li>
</ol>
<h3 id="check-user-validaiton-with-dovecot-imap-server">Check user validaiton with dovecot imap server<a class="headerlink" href="#check-user-validaiton-with-dovecot-imap-server" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>root@mail:/var/log# doveadm user thara@coppermail.dyndns.org
field valuedoveadm(thara@coppermail.dyndns.org): Error: user thara@coppermail.dyndns.org: Auth USER lookup failed

* then check configurations
10-auth.conf
and
</pre></div>


<h3 id="test-imap-server-dovecot-with-telnet">Test imap server (dovecot) with telnet<a class="headerlink" href="#test-imap-server-dovecot-with-telnet" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>root@mail:/etc/dovecot/conf.d# telnet localhost 143
Trying 127.0.0.1…
Connected to localhost.
Escape character is ‘^]’.
* OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE AUTH=PLAIN AUTH=LOGIN] Dovecot ready.
01 login thara@coppermail.dyndns.org postfix@123
01 OK [CAPABILITY IMAP4rev1 LITERAL+ SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT SORT=DISPLAY THREAD=REFERENCES THREAD=REFS THREAD=ORDEREDSUBJECT MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS LIST-EXTENDED I18NLEVEL=1 CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES WITHIN CONTEXT=SEARCH LIST-STATUS BINARY MOVE QUOTA] Logged in
. list “” “*”
* LIST (\HasNoChildren \Drafts) “.” Drafts
* LIST (\HasNoChildren \Junk) “.” Junk
* LIST (\HasNoChildren \Sent) “.” Sent
* LIST (\HasNoChildren \Trash) “.” Trash
* LIST (\HasNoChildren \Junk) “.” Spam
* LIST (\HasNoChildren \Archive) “.” Archive
* LIST (\HasNoChildren) “.” INBOX
. OK List completed (0.001 + 0.000 secs).
? select inbox
* FLAGS (\Answered \Flagged \Deleted \Seen \Draft)
* OK [PERMANENTFLAGS (\Answered \Flagged \Deleted \Seen \Draft \*)] Flags permitted.
* 0 EXISTS
* 0 RECENT
* OK [UIDVALIDITY 1528974656] UIDs valid
* OK [UIDNEXT 1] Predicted next UID
? OK [READ-WRITE] Select completed (0.008 + 0.000 + 0.007 secs).
?fetch 1 body[text]
?fetch BAD Error in IMAP command 1: Unknown command (4261338.063 + 0.000 secs).
?fetch 1 header[text]
?fetch BAD Error in IMAP command 1: Unknown command (4261381.185 + 0.000 secs).

? logout
* BYE Logging out
? OK Logout completed (0.001 + 0.000 secs).
Connection closed by foreign host.
</pre></div>


<h2 id="testing-openldap-server">Testing openldap server<a class="headerlink" href="#testing-openldap-server" title="Permanent link">&para;</a></h2>
<h3 id="testing-ldap-server-connectivity">Testing ldap server connectivity.<a class="headerlink" href="#testing-ldap-server-connectivity" title="Permanent link">&para;</a></h3>
<p>The OpenLDAP tools require that you specify an authentication method and a server location for each operation. To specify the server, use the -H flag followed by the protocol and network location of the server in question.</p>
<p>For basic, unencrypted communication, the protocol scheme will be ldap:// like this:</p>
<div class="codehilite"><pre><span></span>ldapsearch -H ldap://server_domain_or_IP . . .
</pre></div>


<p>If you are communicating with a local server, you can leave off the server domain name or IP address (you still need to specify the scheme).</p>
<h3 id="use-ldif-file-for-changingupdating-the-openldap-server">Use ldif file for changing/updating the openldap server<a class="headerlink" href="#use-ldif-file-for-changingupdating-the-openldap-server" title="Permanent link">&para;</a></h3>
<p>It is possible to update or change openldap server from command line as explain bellow. 
For example how to add organizational unit using sample.ldif.</p>
<p>sample.ldif : </p>
<div class="codehilite"><pre><span></span>dn: ou=users,dc=coppermail,dc=dyndns,dc=org
changetype: add
objectClass: organizationalUnit
objectclass: top
ou: users
</pre></div>


<p>Command to insert a organization unit from coammand line.</p>
<div class="codehilite"><pre><span></span>ldapmodify -H ldap:// -x -D “cn=admin,dc=coppermail,dc=dyndns,dc=org” -w 12345 -f sample.ldif
</pre></div>


<h3 id="test-the-openldap-server">Test the openLDAP server<a class="headerlink" href="#test-the-openldap-server" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span>ldapwhoami -H ldap:// -x
</pre></div>


<p>above command will check openldap server communication with unsecured parth.</p>
<p>You should now be able to upgrade your connections to use STARTTLS by passing the -Z option when using the OpenLDAP utilities. You can force STARTTLS upgrade by passing it twice. Test this by typing:</p>
<div class="codehilite"><pre><span></span>ldapwhoami -H ldap:// -x -ZZ
</pre></div>


<p>This forces a STARTTLS upgrade. If this is successful, you should see:</p>
<div class="codehilite"><pre><span></span>STARTTLS success

anonymous
</pre></div>


<p>If you mis-configured something, you will likely see an error like this:</p>
<div class="codehilite"><pre><span></span>STARTTLS failure

ldap_start_tls: Connect error (-11)
additional info: (unknown error code)
</pre></div>


<h3 id="advanced-tls-ldap-testing">Advanced TLS - ldap testing<a class="headerlink" href="#advanced-tls-ldap-testing" title="Permanent link">&para;</a></h3>
<p>Command “ldapsearch” with debug level 5, it seems succeed in Executing START TLS, and the ldap server’s certificate is valid,but it shows some other strange errors:</p>
<div class="codehilite"><pre><span></span>ldapsearch -ZZ -d 5
</pre></div>


<p>If you want to troubleshoot whole TLS communication with ldap server step by step use bellow coammand.</p>
<div class="codehilite"><pre><span></span>ldapsearch -x -ZZ -d1
</pre></div>


<h2 id="database-testing">Database Testing<a class="headerlink" href="#database-testing" title="Permanent link">&para;</a></h2>
<div class="codehilite"><pre><span></span>Now a groupoffice database should be created preor to start groupoffice installation begins.

first you have to check what is the pod name of dataase.

#kubectl get pods -n  monitoring

Then exicute followng command to open a mysql client connected with the mysql pod.

#kubectl run -it --rm --image=mysql:5.6 --restart=Never mysql-client -n monitoring -- mysql -h mysql -pc0pperDB

Then you will get access to the mysql database.
Once you connected check databae.

    SHOW DATABASES;
    USE copper;
    SHOW TABLES;
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Backups/" title="Backup & Restoration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Backup & Restoration
              </span>
            </div>
          </a>
        
        
          <a href="../Hub/" title="Central Supervision" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Central Supervision
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2019 Lanka Software Foundation
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.267712eb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>